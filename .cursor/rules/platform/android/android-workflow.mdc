---
description: Android Development Workflow - Quy tr√¨nh ph√°t tri·ªÉn Android theo blueprint kh√¥ng d√πng script. K√≠ch ho·∫°t khi working v·ªõi Android development, Kotlin projects, ho·∫∑c Android ecosystem development.
alwaysApply: false
---

## Quy Tr√¨nh Blueprint-First

- **_B·∫ÆT BU·ªòC_** t·∫°o blueprint tr∆∞·ªõc khi vi·∫øt code cho m·ªói t√≠nh nƒÉng
- **_B·∫ÆT BU·ªòC_** ki·ªÉm tra module registry ƒë·ªÉ tr√°nh tr√πng l·∫∑p
- **_B·∫ÆT BU·ªòC_** c·∫≠p nh·∫≠t module registry sau khi ho√†n th√†nh t√≠nh nƒÉng
- **_B·∫ÆT BU·ªòC_** tu√¢n th·ªß c·∫•u tr√∫c package ti√™u chu·∫©n
- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng c√°c base classes ƒë√£ c√≥
- **_NGHI√äM C·∫§M_** t·∫°o code tr√πng l·∫∑p ch·ª©c nƒÉng ƒë√£ c√≥

## C·∫•u Tr√∫c Package Chu·∫©n

```
com.base.app/
‚îú‚îÄ‚îÄ base/                 # Base classes
‚îÇ   ‚îú‚îÄ‚îÄ activity/         # Base Activities
‚îÇ   ‚îú‚îÄ‚îÄ fragment/         # Base Fragments
‚îÇ   ‚îú‚îÄ‚îÄ viewmodel/        # Base ViewModels
‚îÇ   ‚îú‚îÄ‚îÄ adapter/          # Base Adapters
‚îÇ   ‚îî‚îÄ‚îÄ view/             # Base Custom Views
‚îú‚îÄ‚îÄ core/                 # Core modules
‚îÇ   ‚îú‚îÄ‚îÄ di/               # Dependency Injection
‚îÇ   ‚îú‚îÄ‚îÄ network/          # Network components
‚îÇ   ‚îú‚îÄ‚îÄ storage/          # Local storage
‚îÇ   ‚îú‚îÄ‚îÄ analytics/        # Analytics tracking
‚îÇ   ‚îî‚îÄ‚îÄ utils/            # Utility classes
‚îú‚îÄ‚îÄ data/                 # Data layer
‚îÇ   ‚îú‚îÄ‚îÄ repository/       # Repositories implementation
‚îÇ   ‚îú‚îÄ‚îÄ datasource/       # Data sources (remote, local)
‚îÇ   ‚îú‚îÄ‚îÄ model/            # Data models (entities, DTOs)
‚îÇ   ‚îî‚îÄ‚îÄ mapper/           # Mappers
‚îú‚îÄ‚îÄ domain/               # Domain layer
‚îÇ   ‚îú‚îÄ‚îÄ usecase/          # Use cases (business logic)
‚îÇ   ‚îú‚îÄ‚îÄ model/            # Domain models
‚îÇ   ‚îî‚îÄ‚îÄ repository/       # Repository interfaces
‚îî‚îÄ‚îÄ ui/                   # UI layer
    ‚îú‚îÄ‚îÄ components/       # Shared UI components
    ‚îî‚îÄ‚îÄ features/         # Feature packages
        ‚îú‚îÄ‚îÄ feature1/     # T√≠nh nƒÉng 1
        ‚îú‚îÄ‚îÄ feature2/     # T√≠nh nƒÉng 2
        ‚îî‚îÄ‚îÄ ...
```

## Feature Blueprint Template

```markdown
# FEATURE BLUEPRINT: [T√™n T√≠nh NƒÉng]

## M√î T·∫¢

[M√¥ t·∫£ chi ti·∫øt v·ªÅ t√≠nh nƒÉng]

## DOMAIN LAYER

- Models:
  - [Model 1]: [M√¥ t·∫£]
  - [Model 2]: [M√¥ t·∫£]
- Use Cases:
  - [UseCase 1]: [Input/Output, m√¥ t·∫£]
  - [UseCase 2]: [Input/Output, m√¥ t·∫£]

## DATA LAYER

- Repository: [T√™n repository]
- API Endpoints (n·∫øu c√≥):
  - [Endpoint 1]: [Method, URL pattern, params]
- Local Storage (n·∫øu c√≥):
  - [Entity/Table 1]: [M√¥ t·∫£]

## UI LAYER

- ViewModels:
  - [ViewModel 1]: [States, Events]
- Screens:
  - [Screen 1]: [Layout, components]
- Components:
  - [Component 1]: [M·ª•c ƒë√≠ch, t√°i s·ª≠ d·ª•ng]

## RESOURCES

- Strings: [Danh s√°ch string keys]
- Colors: [M√†u s·∫Øc c·∫ßn th√™m]
- Drawables: [Resources c·∫ßn thi·∫øt]
```

## Quy Tr√¨nh L√†m Vi·ªác

### B∆∞·ªõc 1: T·∫°o Feature Blueprint

1. T·∫°o file blueprint trong th∆∞ m·ª•c `blueprint/features/`
2. ƒê·∫∑t t√™n file: `[feature-name]-blueprint.md`
3. S·ª≠ d·ª•ng Feature Blueprint Template ·ªü tr√™n
4. ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√†o c√°c section

### B∆∞·ªõc 2: T·∫°o C·∫•u Tr√∫c Package

1. T·∫°o package theo feature name trong `com.base.app.ui.features`
2. T·∫°o c√°c sub-packages:
   - `ui/features/[feature]/presentation` (fragments, adapters)
   - `ui/features/[feature]/viewmodel`
   - `domain/usecase/[feature]` (n·∫øu c·∫ßn)
   - `data/repository/[feature]` (n·∫øu c·∫ßn)

### B∆∞·ªõc 3: Tri·ªÉn Khai Theo Layer

1. Tri·ªÉn khai Domain Layer:

   - T·∫°o domain models
   - T·∫°o repository interfaces
   - T·∫°o use cases

2. Tri·ªÉn khai Data Layer:

   - T·∫°o data models
   - T·∫°o data sources (remote, local)
   - T·∫°o repository implementation

3. Tri·ªÉn khai UI Layer:
   - T·∫°o ViewModels
   - T·∫°o UI components
   - T·∫°o Screens/Fragments

### B∆∞·ªõc 4: C·∫≠p Nh·∫≠t Registry

1. C·∫≠p nh·∫≠t `blueprint/module-registry.md` v·ªõi c√°c components m·ªõi
2. C·∫≠p nh·∫≠t `blueprint/component-catalog.md` v·ªõi UI components m·ªõi

## Quy T·∫Øc Ch·ªëng Tr√πng L·∫∑p Code

- **_B·∫ÆT BU·ªòC_** tr∆∞·ªõc khi t·∫°o class/function/resource m·ªõi:

  1. T√¨m ki·∫øm trong project v·ªõi pattern: `class/interface/fun [T√™n]`
  2. Ki·ªÉm tra module-registry.md
  3. Ki·ªÉm tra component-catalog.md
  4. T√¨m trong package `core/utils` tr∆∞·ªõc khi t·∫°o utility functions
  5. T√¨m trong package `ui/components` tr∆∞·ªõc khi t·∫°o UI components m·ªõi
  6. ∆Øu ti√™n m·ªü r·ªông code hi·ªán c√≥ thay v√¨ t·∫°o m·ªõi

- **_B·∫ÆT BU·ªòC_** khi g·∫∑p logic t∆∞∆°ng t·ª± ·ªü 2+ n∆°i:

  1. Tr√≠ch xu·∫•t v√†o base class/util class
  2. T·∫°o extension function cho code d√πng chung
  3. C·∫≠p nh·∫≠t t·∫•t c·∫£ occurrences ƒë·ªÉ s·ª≠ d·ª•ng code d√πng chung

- **_KHUY·∫æN NGH·ªä_** khi th·∫•y code t∆∞∆°ng t·ª± nh∆∞ng kh√°c bi·ªát nh·ªè:
  1. T√¨m m·∫´u chung v√† tham s·ªë h√≥a s·ª± kh√°c bi·ªát
  2. T·∫°o m·ªôt version t·ªïng qu√°t c√≥ th·ªÉ t√πy ch·ªânh
  3. T√°i c·∫•u tr√∫c code hi·ªán t·∫°i ƒë·ªÉ d√πng version t·ªïng qu√°t

## Lu·ªìng T·∫°o D·ª± √Ån Android T·ª± ƒê·ªông

### B∆∞·ªõc 1: ƒê·ªãnh Nghƒ©a Ki·∫øn Tr√∫c C·ªët L√µi

- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng **MVVM + Clean Architecture** v·ªõi ph√¢n t√°ch 3 l·ªõp:
  - **UI Layer**: Composables + ViewModels
  - **Domain Layer**: Use Cases + Models + Repository Interfaces
  - **Data Layer**: Repository Implementations + Data Sources
- **_B·∫ÆT BU·ªòC_** ƒë·∫£m b·∫£o **Unidirectional Data Flow**: UI ‚Üí ViewModel ‚Üí UseCase ‚Üí Repository

#### Tech Stack Chu·∫©n:

```kotlin
// UI Framework
implementation "androidx.compose.ui:compose-ui:$compose_version"
implementation "androidx.compose.material3:material3:$material3_version"

// Dependency Injection - Ch·ªçn 1 trong 2:
implementation "com.google.dagger:hilt-android:$hilt_version" // D·ª± √°n l·ªõn, ki·ªÉm so√°t ch·∫∑t
// HO·∫∂C
implementation "io.insert-koin:koin-android:$koin_version" // ƒê∆°n gi·∫£n, APK nh·ªè h∆°n

// Async Programming
implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:$coroutines_version"

// Networking
implementation "com.squareup.retrofit2:retrofit:$retrofit_version"
implementation "com.squareup.okhttp3:okhttp:$okhttp_version"

// Serialization
implementation "org.jetbrains.kotlinx:kotlinx-serialization-json:$serialization_version"

// Database
implementation "androidx.room:room-runtime:$room_version"
implementation "androidx.room:room-ktx:$room_version"

// Image Loading
implementation "io.coil-kt:coil-compose:$coil_version"

// Logging
implementation "com.jakewharton.timber:timber:$timber_version"

// Permissions (Optional)
implementation "com.karumi:dexter:$dexter_version"
```

### B∆∞·ªõc 2: Thi·∫øt L·∫≠p Build Configuration & T·ªëi ∆Øu

#### Gradle Configuration (build.gradle :app)

```kotlin
android {
    buildTypes {
        release {
            minifyEnabled = true
            shrinkResources = true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    defaultConfig {
        // ABI Filtering - ch·ªâ h·ªó tr·ª£ ARM
        ndk {
            abiFilters 'armeabi-v7a', 'arm64-v8a'
        }
    }

    // Enable Android App Bundle
    bundle {
        language {
            enableSplit = true
        }
        density {
            enableSplit = true
        }
        abi {
            enableSplit = true
        }
    }
}
```

#### T·ªëi ∆Øu Resource:

- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng **Vector Drawables** cho icons
- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng **WebP** format cho images
- **_B·∫ÆT BU·ªòC_** auto-optimize images khi import v√†o project

### B∆∞·ªõc 3: Quy T·∫Øc Sinh Code Cho AI

#### Component Reusability:

```kotlin
// Base Composables
@Composable
fun BaseButton(
    text: String,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
    enabled: Boolean = true,
    type: ButtonType = ButtonType.PRIMARY
) { /* Implementation */ }

// Base ViewModel
abstract class BaseViewModel : ViewModel() {
    protected val _uiState = MutableStateFlow(UiState.Loading)
    val uiState = _uiState.asStateFlow()

    protected fun handleError(error: Throwable) {
        Timber.e(error, "Error in ${this::class.simpleName}")
        _uiState.value = UiState.Error(error.message ?: "Unknown error")
    }
}

// Base UseCase
abstract class BaseUseCase<in P, R> {
    suspend operator fun invoke(parameters: P): Result<R> = runCatching {
        execute(parameters)
    }

    protected abstract suspend fun execute(parameters: P): R
}
```

#### Error Handling Pattern:

```kotlin
// Repository Pattern with Error Handling
class UserRepository @Inject constructor(
    private val remoteDataSource: UserRemoteDataSource,
    private val localDataSource: UserLocalDataSource
) : IUserRepository {

    override suspend fun getUser(id: String): Result<User> = runCatching {
        try {
            val remoteUser = remoteDataSource.getUser(id)
            localDataSource.saveUser(remoteUser)
            remoteUser
        } catch (e: Exception) {
            Timber.w(e, "Failed to fetch from remote, trying local")
            localDataSource.getUser(id) ?: throw e
        }
    }
}
```

#### State Management Pattern:

```kotlin
class FeatureViewModel @Inject constructor(
    private val getUserUseCase: GetUserUseCase
) : BaseViewModel() {

    private val _userState = MutableStateFlow<UserUiState>(UserUiState.Loading)
    val userState = _userState.asStateFlow()

    fun loadUser(userId: String) {
        viewModelScope.launch {
            _userState.value = UserUiState.Loading
            getUserUseCase(userId)
                .onSuccess { user ->
                    _userState.value = UserUiState.Success(user)
                }
                .onFailure { error ->
                    handleError(error)
                    _userState.value = UserUiState.Error(error.message ?: "Unknown error")
                }
        }
    }
}

sealed class UserUiState {
    object Loading : UserUiState()
    data class Success(val user: User) : UserUiState()
    data class Error(val message: String) : UserUiState()
}
```

### B∆∞·ªõc 4: Testing Setup

#### Unit Test Template:

```kotlin
@ExperimentalCoroutinesTest
class FeatureViewModelTest {

    @Mock private lateinit var getUserUseCase: GetUserUseCase

    private lateinit var viewModel: FeatureViewModel
    private val testDispatcher = TestCoroutineDispatcher()

    @Before
    fun setup() {
        MockKAnnotations.init(this)
        Dispatchers.setMain(testDispatcher)
        viewModel = FeatureViewModel(getUserUseCase)
    }

    @Test
    fun `loadUser success updates state correctly`() = runTest {
        // Given
        val expectedUser = User("1", "John Doe")
        coEvery { getUserUseCase("1") } returns Result.success(expectedUser)

        // When
        viewModel.loadUser("1")

        // Then
        assertEquals(UserUiState.Success(expectedUser), viewModel.userState.value)
    }
}
```

#### UI Test Template:

```kotlin
@ExperimentalComposeUiApi
class FeatureScreenTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun userScreen_displaysUserInfo_whenStateIsSuccess() {
        // Given
        val user = User("1", "John Doe")

        // When
        composeTestRule.setContent {
            UserScreen(
                uiState = UserUiState.Success(user),
                onAction = {}
            )
        }

        // Then
        composeTestRule.onNodeWithText("John Doe").assertIsDisplayed()
    }
}
```

### B∆∞·ªõc 5: Performance Monitoring Setup

#### Firebase Integration:

```kotlin
// Application Class
class MyApplication : Application() {
    override fun onCreate() {
        super.onCreate()

        // Timber logging
        if (BuildConfig.DEBUG) {
            Timber.plant(Timber.DebugTree())
        }

        // Firebase Crashlytics
        FirebaseCrashlytics.getInstance().setCrashlyticsCollectionEnabled(!BuildConfig.DEBUG)

        // Performance Monitoring
        FirebasePerformance.getInstance().isPerformanceCollectionEnabled = true
    }
}
```

#### Performance Traces:

```kotlin
// Repository with Performance Monitoring
class NetworkRepository {
    suspend fun fetchData(): Result<Data> {
        val trace = FirebasePerformance.getInstance().newTrace("fetch_data")
        trace.start()

        return try {
            val result = apiService.getData()
            trace.putAttribute("success", "true")
            Result.success(result)
        } catch (e: Exception) {
            trace.putAttribute("success", "false")
            trace.putAttribute("error", e.message ?: "unknown")
            Result.failure(e)
        } finally {
            trace.stop()
        }
    }
}
```

## Quy T·∫Øc T·ªëi ∆Øu APK Size

### Resource Optimization:

- **_B·∫ÆT BU·ªòC_** compress images tr∆∞·ªõc khi add v√†o project
- **_B·∫ØT BU·ªòC_** s·ª≠ d·ª•ng vector drawables thay v√¨ multiple density images
- **_B·∫ÆT BU·ªòC_** remove unused resources v·ªõi `shrinkResources = true`

### Code Optimization:

- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng R8/ProGuard ƒë·ªÉ minify code
- **_B·∫ÆT BU·ªòC_** avoid reflection khi c√≥ th·ªÉ
- **_B·∫ÆT BU·ªòC_** s·ª≠ d·ª•ng `@Keep` annotation cho classes c·∫ßn thi·∫øt

### Dependency Management:

- **_B·∫ÆT BU·ªòC_** regularly audit dependencies v√† remove unused ones
- **_KHUY·∫æN NGH·ªä_** prefer lightweight alternatives khi c√≥ th·ªÉ
- **_KHUY·∫æN NGH·ªä_** s·ª≠ d·ª•ng `implementation` thay v√¨ `api` trong Gradle

## üî¥ CRITICAL: Error Prevention Integration

### **B·∫ÆT BU·ªòC** - Apply Error Prevention Rules

- **B·∫ÆT BU·ªòC** tu√¢n th·ªß 100% [Android Error Prevention Rules](./android-error-prevention.mdc)
- **B·∫ÆT BU·ªòC** s·ª≠ d·ª•ng [AI Android Quality Enforcer](./ai-android-quality-enforcer.mdc) cho m·ªçi code generation
- **B·∫ÆT BU·ªòC** √°p d·ª•ng [Real-time Error Detector](./android-realtime-error-detector.mdc) trong qu√° tr√¨nh development

### **Error Prevention Checklist (B·∫ÆT BU·ªòC 100%)**

- [ ] **Type Safety**: Kh√¥ng c√≥ type inference errors
- [ ] **Import Resolution**: T·∫•t c·∫£ imports ƒë∆∞·ª£c resolve
- [ ] **Null Safety**: S·ª≠ d·ª•ng safe calls cho nullable types
- [ ] **Method Signatures**: Parameters v√† return types kh·ªõp
- [ ] **When Expressions**: Exhaustive v·ªõi else branches
- [ ] **Resource Validation**: T·∫•t c·∫£ R.\* references t·ªìn t·∫°i
- [ ] **Error Handling**: Try-catch cho risky operations
- [ ] **ViewBinding Cleanup**: Proper null assignment trong onDestroyView
- [ ] **Lifecycle Awareness**: Coroutines s·ª≠ d·ª•ng appropriate scopes

## Danh S√°ch Ki·ªÉm Tra Ch·∫•t L∆∞·ª£ng

- [ ] **Error Prevention Compliance**: 100% tu√¢n th·ªß error prevention rules
- [ ] MVVM + Clean Architecture ƒë∆∞·ª£c implement ƒë√∫ng
- [ ] Unidirectional Data Flow ƒë∆∞·ª£c ƒë·∫£m b·∫£o
- [ ] R8/ProGuard configuration ho·∫°t ƒë·ªông
- [ ] Vector Drawables ƒë∆∞·ª£c s·ª≠ d·ª•ng cho icons
- [ ] WebP format ƒë∆∞·ª£c s·ª≠ d·ª•ng cho images
- [ ] Unit tests cover ViewModels v√† UseCases
- [ ] UI tests cover critical user flows
- [ ] Error handling ƒë∆∞·ª£c implement ƒë·∫ßy ƒë·ªß
- [ ] Performance monitoring ƒë∆∞·ª£c setup
- [ ] APK size ƒë∆∞·ª£c t·ªëi ∆∞u (d∆∞·ªõi ng∆∞·ª°ng target)
- [ ] Code tu√¢n th·ªß c·∫•u tr√∫c package ƒë·ªãnh nghƒ©a
- [ ] Classes ƒë∆∞·ª£c ƒë·∫∑t ƒë√∫ng package
- [ ] Kh√¥ng c√≥ code tr√πng l·∫∑p ch·ª©c nƒÉng
- [ ] S·ª≠ d·ª•ng c√°c base classes khi th√≠ch h·ª£p
- [ ] UI components ƒë∆∞·ª£c t√°i s·ª≠ d·ª•ng khi c√≥ th·ªÉ
- [ ] Blueprint ƒë∆∞·ª£c ho√†n thi·ªán tr∆∞·ªõc khi vi·∫øt code
- [ ] Module Registry ƒë∆∞·ª£c c·∫≠p nh·∫≠t sau khi ho√†n th√†nh
- [ ] **AI Quality Enforcer**: Passed all validation checks
- [ ] **Real-time Error Detection**: No critical issues detected
